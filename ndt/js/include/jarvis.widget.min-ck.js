(function(e,t,n,r){function s(t,n){this.obj=e(t);this.o=e.extend({},e.fn[i].defaults,n);this.objId=this.obj.attr("id");this.pwCtrls=".jarviswidget-ctrls";this.widget=this.obj.find(this.o.widgets);this.toggleClass=this.o.toggleClass.split("|");this.editClass=this.o.editClass.split("|");this.fullscreenClass=this.o.fullscreenClass.split("|");this.customClass=this.o.customClass.split("|");this.init()}var i="jarvisWidgets";s.prototype={_settings:function(){var e=this;storage=!!function(){var e,t=+(new Date);try{localStorage.setItem(t,t);e=localStorage.getItem(t)==t;localStorage.removeItem(t);return e}catch(n){}}()&&localStorage;if(storage&&e.o.localStorage){keySettings="Plugin_settings_"+location.pathname+"_"+e.objId;getKeySettings=localStorage.getItem(keySettings);keyPosition="Plugin_position_"+location.pathname+"_"+e.objId;getKeyPosition=localStorage.getItem(keyPosition)}"ontouchstart"in t||t.DocumentTouch&&n instanceof DocumentTouch?clickEvent="click tap":clickEvent="click"},_runLoaderWidget:function(e){var t=this;t.o.indicator===!0&&e.parents(t.o.widgets).find(".jarviswidget-loader").stop(!0,!0).fadeIn(100).delay(t.o.indicatorTime).fadeOut(100)},_getPastTimestamp:function(e){var t=this,n=new Date(e);r=n.getMonth()+1;i=n.getDate();tsYear=n.getFullYear();s=n.getHours();o=n.getMinutes();u=n.getUTCSeconds();if(r<10)var r="0"+r;if(i<10)var i="0"+i;if(s<10)var s="0"+s;if(o<10)var o="0"+o;if(u<10)var u="0"+u;var a=t.o.timestampFormat.replace(/%d%/g,i).replace(/%m%/g,r).replace(/%y%/g,tsYear).replace(/%h%/g,s).replace(/%i%/g,o).replace(/%s%/g,u);return a},_loadAjaxFile:function(t,n,r){var i=this;t.find(".jarviswidget-ajax-placeholder").load(n,function(n,r,s){r=="error"&&e(this).html('<div class="inner-spacer">'+i.o.labelError+"<b>"+s.status+" "+s.statusText+"</b></div>");if(r=="success"){var o=t.find(i.o.timestampPlaceholder);o.length&&o.html(i._getPastTimestamp(new Date));typeof i.o.afterLoad=="function"&&i.o.afterLoad.call(this,t)}});i._runLoaderWidget(r)},_saveSettingsWidget:function(){var t=this;t._settings();if(storage&&t.o.localStorage){var n=[];t.obj.find(t.o.widgets).each(function(){var t={};t.id=e(this).attr("id");t.style=e(this).attr("data-widget-attstyle");t.title=e(this).children("header").children("h2").text();t.hidden=e(this).is(":hidden")?1:0;t.collapsed=e(this).hasClass("jarviswidget-collapsed")?1:0;n.push(t)});var r=JSON.stringify({widget:n});getKeySettings!=r&&localStorage.setItem(keySettings,r)}typeof t.o.onSave=="function"&&t.o.onSave.call(this,null,r)},_savePositionWidget:function(){var t=this;t._settings();if(storage&&t.o.localStorage){var n=[];t.obj.find(t.o.grid+".sortable-grid").each(function(){var r=[];e(this).children(t.o.widgets).each(function(){var t={};t.id=e(this).attr("id");r.push(t)});var i={section:r};n.push(i)});var r=JSON.stringify({grid:n});getKeyPosition!=r&&localStorage.setItem(keyPosition,r,null)}typeof t.o.onSave=="function"&&t.o.onSave.call(this,r)},init:function(){var t=this;t._settings();e("#"+t.objId).length||alert("It looks like your using a class instead of an ID, dont do that!");t.o.rtl===!0&&e("body").addClass("rtl");e(t.o.grid).each(function(){e(this).find(t.o.widgets).length&&e(this).addClass("sortable-grid")});if(storage&&t.o.localStorage&&getKeyPosition){var n=JSON.parse(getKeyPosition);for(var i in n.grid){var s=t.obj.find(t.o.grid+".sortable-grid").eq(i);for(var o in n.grid[i].section)s.append(e("#"+n.grid[i].section[o].id))}}if(storage&&t.o.localStorage&&getKeySettings){var u=JSON.parse(getKeySettings);for(var i in u.widget){var a=e("#"+u.widget[i].id);u.widget[i].style&&a.addClass(u.widget[i].style).attr("data-widget-attstyle",""+u.widget[i].style+"");u.widget[i].hidden==1?a.hide(1):a.show(1).removeAttr("data-widget-hidden");u.widget[i].collapsed==1&&a.addClass("jarviswidget-collapsed").children("div").hide(1);a.children("header").children("h2").text()!=u.widget[i].title&&a.children("header").children("h2").text(u.widget[i].title)}}t.widget.each(function(){var n=e(this),i=e(this).children("header");if(!i.parent().attr("role")){n.data("widget-hidden")===!0&&n.hide();n.data("widget-collapsed")===!0&&n.addClass("jarviswidget-collapsed").children("div").hide();n.data("widget-icon")&&i.prepend('<i class="jarviswidget-icon '+n.data("widget-icon")+'"></i>');if(t.o.customButton===!0&&n.data("widget-custombutton")===r&&t.customClass[0].length!=0)var s='<a href="#" class="button-icon btn jarviswidget-custom-btn"><i class="'+t.customClass[0]+'"></i></a>';else s="";if(t.o.deleteButton===!0&&n.data("widget-deletebutton")===r)var o='<a href="#" class="button-icon btn jarviswidget-delete-btn"><i class="'+t.o.deleteClass+'"></i></a>';else o="";if(t.o.editButton===!0&&n.data("widget-editbutton")===r)var u='<a href="#" class="button-icon btn jarviswidget-edit-btn"><i class="'+t.editClass[0]+'"></i></a>';else u="";if(t.o.fullscreenButton===!0&&n.data("widget-fullscreenbutton")===r)var a='<a href="#" class="button-icon btn jarviswidget-fullscreen-btn"><i class="'+t.fullscreenClass[0]+'"></i></a>';else a="";if(t.o.toggleButton===!0&&n.data("widget-togglebutton")===r){if(n.data("widget-collapsed")===!0||n.hasClass("jarviswidget-collapsed"))var f=t.toggleClass[1];else f=t.toggleClass[0];var l='<a href="#" class="button-icon btn jarviswidget-toggle-btn"><i class="'+f+'"></i></a>'}else l="";if(t.o.refreshButton===!0&&n.data("widget-refreshbutton")!=0&&n.data("widget-load"))var c='<a href="#" class="button-icon btn jarviswidget-refresh-btn"><i class="'+t.o.refreshButtonClass+'"></i></a>';else c="";var h=t.o.buttonOrder.replace(/%refresh%/g,c).replace(/%delete%/g,o).replace(/%custom%/g,s).replace(/%fullscreen%/g,a).replace(/%edit%/g,u).replace(/%toggle%/g,l);(c!=""||o!=""||s!=""||a!=""||u!=""||l!="")&&i.append('<div class="jarviswidget-ctrls">'+h+"</div>");t.o.sortable===!0&&n.data("widget-sortable")===r&&n.addClass("jarviswidget-sortable");n.find(t.o.editPlaceholder).length&&n.find(t.o.editPlaceholder).find("input").val(i.children("h2").text());i.append('<span class="jarviswidget-loader"><i class="icon-spinner icon-spin"></></span>');n.attr("role","widget").children("div").attr("role","content").prev("header").attr("role","heading").children("div").attr("role","menu")}});t.o.buttonsHidden===!0&&e(t.o.pwCtrls).hide();t.obj.find("[data-widget-load]").each(function(){var n=e(this),r=n.children(),i=n.data("widget-load"),s=n.data("widget-refresh")*1e3,o=n.children();if(!n.find(".jarviswidget-ajax-placeholder").length){n.children("div:first").append('<div class="jarviswidget-ajax-placeholder"><span style="margin:10px">'+t.o.loadingLabel+"</span></div>");if(n.data("widget-refresh")>0){t._loadAjaxFile(n,i,r);setInterval(function(){t._loadAjaxFile(n,i,r)},s)}else t._loadAjaxFile(n,i,r)}});if(t.o.sortable===!0&&jQuery.ui){var f=t.obj.find(".sortable-grid").not("[data-widget-excludegrid]");f.sortable({items:f.find(".jarviswidget-sortable"),connectWith:f,placeholder:t.o.placeholderClass,cursor:"move",revert:!0,opacity:t.o.opacity,delay:200,cancel:".button-icon, #jarviswidget-fullscreen-mode > div",zIndex:1e4,handle:t.o.dragHandle,forcePlaceholderSize:!0,forceHelperSize:!0,update:function(e,n){t._runLoaderWidget(n.item.children());t._savePositionWidget();typeof t.o.onChange=="function"&&t.o.onChange.call(this,n.item)}})}t.o.buttonsHidden===!0&&t.widget.children("header").hover(function(){e(this).children(t.o.pwCtrls).stop(!0,!0).fadeTo(100,1)},function(){e(this).children(t.o.pwCtrls).stop(!0,!0).fadeTo(100,0)});t._clickEvents();e(t.o.deleteSettingsKey).on(clickEvent,this,function(e){if(storage&&t.o.localStorage){var n=confirm(t.o.settingsKeyLabel);n&&localStorage.removeItem(keySettings)}e.preventDefault()});e(t.o.deletePositionKey).on(clickEvent,this,function(e){if(storage&&t.o.localStorage){var n=confirm(t.o.positionKeyLabel);n&&localStorage.removeItem(keyPosition)}e.preventDefault()});if(storage&&t.o.localStorage){(getKeySettings===null||getKeySettings.length<1)&&t._saveSettingsWidget();(getKeyPosition===null||getKeyPosition.length<1)&&t._savePositionWidget()}},_clickEvents:function(){function r(){if(e("#jarviswidget-fullscreen-mode").length){var r=e(t).height(),i=e("#jarviswidget-fullscreen-mode").find(n.o.widgets).children("header").height();e("#jarviswidget-fullscreen-mode").find(n.o.widgets).children("div").height(r-i-3)}}var n=this;n._settings();n.widget.on(clickEvent,".jarviswidget-toggle-btn",function(t){var r=e(this),i=r.parents(n.o.widgets);n._runLoaderWidget(r);i.hasClass("jarviswidget-collapsed")?r.children().removeClass(n.toggleClass[1]).addClass(n.toggleClass[0]).parents(n.o.widgets).removeClass("jarviswidget-collapsed").children("[role=content]").slideDown(n.o.toggleSpeed,function(){n._saveSettingsWidget()}):r.children().removeClass(n.toggleClass[0]).addClass(n.toggleClass[1]).parents(n.o.widgets).addClass("jarviswidget-collapsed").children("[role=content]").slideUp(n.o.toggleSpeed,function(){n._saveSettingsWidget()});typeof n.o.onToggle=="function"&&n.o.onToggle.call(this,i);t.preventDefault()});n.widget.on(clickEvent,".jarviswidget-fullscreen-btn",function(t){var i=e(this).parents(n.o.widgets),s=i.children("div");n._runLoaderWidget(e(this));if(e("#jarviswidget-fullscreen-mode").length){e(".nooverflow").removeClass("nooverflow");i.unwrap("<div>").children("div").removeAttr("style").end().find(".jarviswidget-fullscreen-btn").children().removeClass(n.fullscreenClass[1]).addClass(n.fullscreenClass[0]).parents(n.pwCtrls).children("a").show();s.hasClass("jarviswidget-visible")&&s.hide().removeClass("jarviswidget-visible")}else{e("body").addClass("nooverflow");i.wrap('<div id="jarviswidget-fullscreen-mode"/>').parent().find(".jarviswidget-fullscreen-btn").children().removeClass(n.fullscreenClass[0]).addClass(n.fullscreenClass[1]).parents(n.pwCtrls).children("a:not(.jarviswidget-fullscreen-btn)").hide();s.is(":hidden")&&s.show().addClass("jarviswidget-visible")}r();typeof n.o.onFullscreen=="function"&&n.o.onFullscreen.call(this,i);t.preventDefault()});e(t).resize(function(){r()});n.widget.on(clickEvent,".jarviswidget-edit-btn",function(t){var r=e(this).parents(n.o.widgets);n._runLoaderWidget(e(this));r.find(n.o.editPlaceholder).is(":visible")?e(this).children().removeClass(n.editClass[1]).addClass(n.editClass[0]).parents(n.o.widgets).find(n.o.editPlaceholder).slideUp(n.o.editSpeed,function(){n._saveSettingsWidget()}):e(this).children().removeClass(n.editClass[0]).addClass(n.editClass[1]).parents(n.o.widgets).find(n.o.editPlaceholder).slideDown(n.o.editSpeed);typeof n.o.onEdit=="function"&&n.o.onEdit.call(this,r);t.preventDefault()});e(n.o.editPlaceholder).find("input").keyup(function(){e(this).parents(n.o.widgets).children("header").children("h2").text(e(this).val())});n.widget.on(clickEvent,"[data-widget-setstyle]",function(t){var r=e(this).data("widget-setstyle"),i="";e(this).parents(n.o.editPlaceholder).find("[data-widget-setstyle]").each(function(){i+=e(this).data("widget-setstyle")+" "});e(this).parents(n.o.widgets).attr("data-widget-attstyle",""+r+"").removeClass(i).addClass(r);n._runLoaderWidget(e(this));n._saveSettingsWidget();t.preventDefault()});n.widget.on(clickEvent,".jarviswidget-custom-btn",function(t){var r=e(this).parents(n.o.widgets);n._runLoaderWidget(e(this));if(e(this).children("."+n.customClass[0]).length){e(this).children().removeClass(n.customClass[0]).addClass(n.customClass[1]);typeof n.o.customStart=="function"&&n.o.customStart.call(this,r)}else{e(this).children().removeClass(n.customClass[1]).addClass(n.customClass[0]);typeof n.o.customEnd=="function"&&n.o.customEnd.call(this,r)}n._saveSettingsWidget();t.preventDefault()});n.widget.on(clickEvent,".jarviswidget-delete-btn",function(t){var r=e(this).parents(n.o.widgets),i=r.attr("id"),s=r.children("header").children("h2").text(),o=confirm(n.o.labelDelete+' "'+s+'"');if(o){n._runLoaderWidget(e(this));e("#"+i).fadeOut(n.o.deleteSpeed,function(){e(this).remove();typeof n.o.onDelete=="function"&&n.o.onDelete.call(this,r)})}t.preventDefault()});n.widget.on(clickEvent,".jarviswidget-refresh-btn",function(t){var r=e(this).parents(n.o.widgets),i=r.data("widget-load"),s=r.children();n._loadAjaxFile(r,i,s);t.preventDefault()})},destroy:function(){var e=this;e.widget.off("click",e._clickEvents());e.obj.removeData(i)}};e.fn[i]=function(t){return this.each(function(){var n=e(this),r=n.data(i),o=typeof t=="object"&&t;r||n.data(i,r=new s(this,o));typeof t=="string"&&r[t]()})};e.fn[i].defaults={grid:"section",widgets:".jarviswidget",localStorage:!0,deleteSettingsKey:"",settingsKeyLabel:"Reset settings?",deletePositionKey:"",positionKeyLabel:"Reset position?",sortable:!0,buttonsHidden:!1,toggleButton:!0,toggleClass:"icon-collapse-top| icon-collapse",toggleSpeed:200,onToggle:function(){},deleteButton:!0,deleteClass:"icon-trash",deleteSpeed:200,onDelete:function(){},editButton:!0,editPlaceholder:".jarviswidget-editbox",editClass:"icon-edit | icon-edit-sign",editSpeed:200,onEdit:function(){},fullscreenButton:!0,fullscreenClass:"icon-resize-full | icon-resize-small",fullscreenDiff:3,onFullscreen:function(){},customButton:!0,customClass:"",customStart:function(){},customEnd:function(){},buttonOrder:"%refresh% %delete% %custom% %edit% %fullscreen% %toggle%",opacity:1,dragHandle:"> header",placeholderClass:"jarviswidget-placeholder",indicator:!0,indicatorTime:600,ajax:!0,loadingLabel:"loading...",timestampPlaceholder:".jarviswidget-timestamp",timestampFormat:"Last update: %m%/%d%/%y% %h%:%i%:%s%",refreshButton:!0,refreshButtonClass:"refresh-10",labelError:"Sorry but there was a error:",labelUpdated:"Last Update:",labelRefresh:"Refresh",labelDelete:"Delete widget:",afterLoad:function(){},rtl:!1,onChange:function(){},onSave:function(){}}})(jQuery,window,document);