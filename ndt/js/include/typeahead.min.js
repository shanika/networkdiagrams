/*
 * Twitter Typeahead
 * https://github.com/twitter/typeahead
 * Copyright 2013 Twitter, Inc. and other contributors; Licensed MIT
 */

var utils={isMsie:function(){return/msie [\w.]+/i.test(navigator.userAgent)},isString:function(t){return"string"==typeof t},isNumber:function(t){return"number"==typeof t},isArray:$.isArray,isFunction:$.isFunction,isObject:function(t){return t!==Object(t)},isUndefined:function(t){return t===void 0},bind:$.proxy,bindAll:function(t){var e;for(var i in t)utils.isFunction(e=t[i])&&(t[i]=$.proxy(e,t))},indexOf:function(t,e){for(var i=0;t.length>i;i++)if(t[i]===e)return i;return-1},each:$.each,map:$.map,filter:function(t,e){var i=[];return $.each(t,function(n,s){e(s,n,t)&&i.push(s)}),i},every:function(t,e){var i=!0;return t?($.each(t,function(n,s){return(i=e.call(null,s,n,t))?void 0:!1}),!!i):i},keys:function(t){if(!utils.isObject(t))throw new TypeError("invalid object");return $.map(t,function(t,e){return e})},mixin:$.extend,getUniqueId:function(){var t=0;return function(){return t++}}(),debounce:function(t,e,i){var n,s;return function(){var r,o,u=this,a=arguments;return r=function(){n=null,i||(s=t.apply(u,a))},o=i&&!n,clearTimeout(n),n=setTimeout(r,e),o&&(s=t.apply(u,a)),s}},throttle:function(t,e){var i,n,s,r,o,u;return o=0,u=function(){o=new Date,s=null,r=t.apply(i,n)},function(){var a=new Date,h=e-(a-o);return i=this,n=arguments,0>=h?(clearTimeout(s),s=null,o=a,r=t.apply(i,n)):s||(s=setTimeout(u,h)),r}},uniqueArray:function(t){for(var e={},i=[],n=0,s=t.length;s>n;++n)e.hasOwnProperty(t[n])||(i.push(t[n]),e[t[n]]=1);return i},tokenizeText:function(t){return $.trim(t).toLowerCase().split(/[\s\-_]+/)},getProtocol:function(){return location.protocol},noop:function(){}},EventTarget=function(){var t=/\s+/;return{on:function(e,i){var n;if(!i)return this;for(this._callbacks=this._callbacks||{},e=e.split(t);n=e.shift();)this._callbacks[n]=this._callbacks[n]||[],this._callbacks[n].push(i);return this},trigger:function(e,i){var n,s;if(!this._callbacks)return this;for(e=e.split(t);n=e.shift();)if(s=this._callbacks[n])for(var r=0;s.length>r;r+=1)s[r].call(this,{type:n,data:i});return this}}}(),PersistentStorage=function(){function t(t){this.prefix=["__",t,"__"].join(""),this.ttlKey="__ttl__",this.keyMatcher=RegExp("^"+this.prefix)}function e(){return(new Date).getTime()}function i(t){return JSON.stringify(t)}function n(t){return utils.isUndefined(t)?void 0:JSON.parse(t)}var s,r=window.localStorage;return s=window.localStorage&&window.JSON?{get:function(t){var i=n(r.getItem(this.prefix+t));return utils.isNumber(i)&&e()>i&&r.removeItem(this.prefix+t+this.ttlKey),n(r.getItem(this.prefix+t))},set:function(t,n,s){return utils.isNumber(s)?r.setItem(this.prefix+t+this.ttlKey,i(e()+s)):r.removeItem(this.prefix+t+this.ttlKey),r.setItem(this.prefix+t,i(n))},remove:function(t){return r.removeItem(this.prefix+t+this.ttlKey),r.removeItem(this.prefix+t),this},clear:function(){var t,e,i=r.length;for(t=0;i>t;t+=1)e=r.key(t),e.match(this.keyMatcher)&&(t-=1,i-=1,this.remove(e.replace(this.keyMatcher,"")));return this},isExpired:function(t){var i=n(r.getItem(this.prefix+t+this.ttlKey));return utils.isNumber(i)&&e()>i?!0:!1}}:{get:utils.noop,set:utils.noop,remove:utils.noop,clear:utils.noop,isExpired:utils.noop},utils.mixin(t.prototype,s),t}(),RequestCache=function(){function t(t){utils.bindAll(this),t=t||{},this.sizeLimit=t.sizeLimit||10,this.cache={},this.cachedKeysByAge=[]}return utils.mixin(t.prototype,{get:function(t){return this.cache[t]},set:function(t,e){var i;this.cachedKeysByAge.length===this.sizeLimit&&(i=this.cachedKeysByAge.shift(),delete this.cache[i]),this.cache[t]=e,this.cachedKeysByAge.push(t)}}),t}(),Transport=function(){function t(t){var e=t.debounce?utils.debounce:utils.throttle;utils.bindAll(this),t=t||{},this.wait=t.wait||300,this.wildcard=t.wildcard||"%QUERY",this.maxConcurrentRequests=t.maxConcurrentRequests||6,this.concurrentRequests=0,this.onDeckRequestArgs=null,this.cache=new RequestCache,this.get=e(this.get,this.wait,!0)}return utils.mixin(t.prototype,{_incrementConcurrentRequests:function(){this.concurrentRequests++},_decrementConcurrentRequests:function(){this.concurrentRequests--},_belowConcurrentRequestsThreshold:function(){return this.concurrentRequests<this.maxConcurrentRequests},get:function(t,e,i){var n,s=this;t=t.replace(this.wildcard,encodeURIComponent(e||"")),(n=this.cache.get(t))?i&&i(n):this._belowConcurrentRequestsThreshold()?$.ajax({url:t,type:"GET",dataType:"json",beforeSend:function(){s._incrementConcurrentRequests()},success:function(e){i&&i(e),s.cache.set(t,e)},complete:function(){s._decrementConcurrentRequests(),s.onDeckRequestArgs&&(s.get.apply(s,s.onDeckRequestArgs),s.onDeckRequestArgs=null)}}):this.onDeckRequestArgs=[].slice.call(arguments,0)}}),t}(),Dataset=function(){function t(t){utils.bindAll(this),this.storage=new PersistentStorage(t.name),this.adjacencyList={},this.itemHash={},this.name=t.name,this.resetDataOnProtocolSwitch=t.resetDataOnProtocolSwitch||!1,this.prefetchUrl=t.prefetch,this.queryUrl=t.remote,this.rawData=t.local,this.transport=t.transport,this.limit=t.limit||10,this._customMatcher=t.matcher||null,this._customRanker=t.ranker||null,this._ttl_ms=t.ttl_ms||2592e5,this.storageAdjacencyList="adjacencyList",this.storageHash="itemHash",this.storageProtocol="protocol",this.storageVersion="version",this._loadData()}return utils.mixin(t.prototype,{_isMetadataExpired:function(){var t=this.storage.isExpired(this.storageProtocol),e=this.resetDataOnProtocolSwitch&&this.storage.get(this.storageProtocol)!=utils.getProtocol();return version!=this.storage.get(this.storageVersion)||e||t?!0:!1},_loadData:function(){this.rawData&&this._processRawData(this.rawData),this._getDataFromLocalStorage(),(this._isMetadataExpired()||this.itemHash==={})&&this.prefetchUrl&&this._prefetch(this.prefetchUrl)},_getDataFromLocalStorage:function(){this.itemHash=this.storage.get(this.storageHash)||this.itemHash,this.adjacencyList=this.storage.get(this.storageAdjacencyList)||this.adjacencyList},_getPotentiallyMatchingIds:function(t){var e=[],i=[];if(utils.map(t,utils.bind(function(t){var e=this.adjacencyList[t.charAt(0)];e&&i.push(e)},this)),1===i.length)return i[0];var n=[];$.each(i,function(t,e){n.push(e.length)});var s=utils.indexOf(n,Math.min.apply(null,n))||0,r=i[s]||[];return e=$.grep(r,function(t){var e=utils.every(i,function(e){return utils.indexOf(e,t)>-1});return e?t:void 0})},_getItemsFromIds:function(t){var e=[];return utils.map(t,utils.bind(function(t){var i=this.itemHash[t];i&&e.push(i)},this)),e},_matcher:function(t){if(this._customMatcher){var e=this._customMatcher;return function(t){return e(t)}}return function(e){var i=e.tokens,n=utils.every(t,function(t){var e=utils.filter(i,function(e){return 0===e.indexOf(t)});return e.length});return n?e:void 0}},_compareItems:function(t,e,i){var n=t.score_boost?t.score_boost:0,s=e.score_boost?e.score_boost:0,r=t.score?t.score:0,o=e.score?e.score:0;return i?e.weight+s-(t.weight+n):o+s-(r+n)},_ranker:function(t,e){if(this._customRanker)return this._customRanker(t,e);var i=t.weight&&0!==t.weight,n=e.weight&&0!==e.weight;return i&&!n?-1:n&&!i?1:i&&n?this._compareItems(t,e,!0):this._compareItems(t,e,!1)},_processRawData:function(t){this.itemHash={},this.adjacencyList={},utils.map(t,utils.bind(function(t){var e;t.tokens?e=t.tokens:(t={tokens:utils.tokenizeText(t),value:t},e=t.tokens),t.id=utils.getUniqueId(t.value),utils.map(e,utils.bind(function(e){var i=e.charAt(0);this.adjacencyList[i]?-1===utils.indexOf(this.adjacencyList[i],t.id)&&this.adjacencyList[i].push(t.id):this.adjacencyList[i]=[t.id]},this)),this.itemHash[t.id]=t},this)),this.storage.set(this.storageHash,this.itemHash,this._ttl_ms),this.storage.set(this.storageAdjacencyList,this.adjacencyList,this._ttl_ms),this.storage.set(this.storageVersion,version,this._ttl_ms),this.storage.set(this.storageProtocol,utils.getProtocol(),this._ttl_ms)},_prefetch:function(t){var e={prefetch:!0,result_type:"any",count:300},i=function(t){t&&(utils.map(t,function(t){var e=t.value||t;t.tokens=$.trim(e).toLowerCase().split(/[\s\-_]+/)}),this._processRawData(t))},n=function(){this._getDataFromLocalStorage()};$.ajax({url:t,data:e,eventData:{},success:utils.bind(i,this),error:utils.bind(n,this)})},_processRemoteSuggestions:function(t){return function(e){var i=utils.map(e,function(t){return utils.isString(t)?{value:t}:t});t&&t(i)}},getSuggestions:function(t,e){var i=utils.tokenizeText(t),n=this._getPotentiallyMatchingIds(i),s=this._getItemsFromIds(n),r=utils.filter(s,this._matcher(i));r.sort(this._ranker),e&&e(r),r.length<this.limit&&this.queryUrl&&this.transport.get(this.queryUrl,t,this._processRemoteSuggestions(e))}}),t}(),InputView=function(){function t(t){var e=this;utils.bindAll(this),this.specialKeyCodeMap={9:{event:"tab"},27:{event:"esc"},37:{event:"left"},39:{event:"right"},13:{event:"enter"},38:{event:"up",preventDefault:!0},40:{event:"down",preventDefault:!0}},this.query="",this.$hint=$(t.hint),this.$input=$(t.input).on("blur",this._handleBlur).on("focus",this._handleFocus).on("keydown",this._handleSpecialKeyEvent),utils.isMsie()?this.$input.on("keydown keypress textinput textInput cut paste",function(t){e.specialKeyCodeMap[t.which||t.keyCode]||setTimeout(e._compareQueryToInputValue,0)}):this.$input.on("input",this._compareQueryToInputValue)}function e(t,e){return t=(t||"").replace(/^\s*/g,"").replace(/\s{2,}/g," ").toLowerCase(),e=(e||"").replace(/^\s*/g,"").replace(/\s{2,}/g," ").toLowerCase(),t===e}return utils.mixin(t.prototype,EventTarget,{_handleFocus:function(){this.$input.addClass("tt-focus"),this.$hint.addClass("tt-focus"),this.trigger("focus")},_handleBlur:function(){this.$input.removeClass("tt-focus"),this.$hint.removeClass("tt-focus"),this.trigger("blur")},_handleSpecialKeyEvent:function(t){var e=this.specialKeyCodeMap[t.which||t.keyCode];e&&(e.preventDefault&&t.preventDefault(),this.trigger(e.event,t))},_compareQueryToInputValue:function(){var t=this.getInputValue(),i=e(this.query,t),n=i?this.query.length!==t.length:!1;n?this.trigger("whitespaceChange",{value:this.query}):i||this.trigger("queryChange",{value:this.query=t})},focus:function(){this.$input.focus()},blur:function(){this.$input.blur()},setPreventDefaultValueForKey:function(t,e){this.specialKeyCodeMap[t].preventDefault=!!e},getQuery:function(){return this.query},getInputValue:function(){return this.$input.val()},setInputValue:function(t,e){this.$input.val(t),e!==!0&&this._compareQueryToInputValue()},getHintValue:function(){return this.$hint.val()},setHintValue:function(t){this.$hint.val(t)},getLanguageDirection:function(){return(this.$input.css("direction")||"ltr").toLowerCase()},isCursorAtEnd:function(){var t,e=this.$input.val().length,i=this.$input[0].selectionStart;return i?i===e:document.selection?(this.$input.focus(),t=document.selection.createRange(),t.moveStart("character",-e),e===t.text.length):!0}}),t}(),DropdownView=function(){function t(t){utils.bindAll(this),this.isMouseOverDropdown,this.$menu=$(t.menu).on("mouseenter",this._handleMouseenter).on("mouseleave",this._handleMouseleave).on("mouseover",".tt-suggestions > .tt-suggestion",this._handleMouseover).on("click",".tt-suggestions > .tt-suggestion",this._handleSelection)}function e(t){var e=t.parents(".tt-suggestions").first();return{value:t.data("value"),query:e.data("query"),dataset:e.data("dataset")}}return utils.mixin(t.prototype,EventTarget,{_handleMouseenter:function(){this.isMouseOverDropdown=!0},_handleMouseleave:function(){this.isMouseOverDropdown=!1},_handleMouseover:function(t){this._getSuggestions().removeClass("tt-under-cursor"),$(t.currentTarget).addClass("tt-under-cursor")},_handleSelection:function(t){this.trigger("select",e($(t.currentTarget)))},_moveCursor:function(t){var e,i,n,s;if(this.$menu.hasClass("tt-show")){if(e=this._getSuggestions(),i=e.filter(".tt-under-cursor"),i.removeClass("tt-under-cursor"),n=e.index(i)+t,n=(n+1)%(e.length+1)-1,-1===n)return this.trigger("cursorOff"),void 0;-1>n&&(n=e.length-1),s=e.eq(n).addClass("tt-under-cursor"),this.trigger("cursorOn",{value:s.data("value")})}},_getSuggestions:function(){return this.$menu.find(".tt-suggestions > .tt-suggestion")},hideUnlessMouseIsOverDropdown:function(){this.isMouseOverDropdown||this.hide()},hideIfEmpty:function(){0===this._getSuggestions().length&&this.hide()},hide:function(){this.$menu.hasClass("tt-show")&&(this.$menu.removeClass("tt-show").find(".tt-suggestions > .tt-suggestion").removeClass("tt-under-cursor"),this.trigger("hide"))},show:function(){this.$menu.hasClass("tt-show")||(this.$menu.addClass("tt-show"),this.trigger("show"))},moveCursorUp:function(){this._moveCursor(-1)},moveCursorDown:function(){this._moveCursor(1)},getSuggestionUnderCursor:function(){var t=this._getSuggestions().filter(".tt-under-cursor").first();return t.length>0?e(t):null},getFirstSuggestion:function(){var t=this._getSuggestions().first();return t.length>0?e(t):null},renderSuggestions:function(t,e,i){var n,s,r,o="tt-dataset-"+e.name,u=this.$menu.find("."+o);0===u.length&&(u=$('<li><ol class="tt-suggestions"></ol></li>').addClass(o).appendTo(this.$menu)),n=document.createElement("div"),s=document.createDocumentFragment(),i.length>0&&(utils.each(i,function(t,i){n.innerHTML=e.template.render(i),r=n.firstChild,r.setAttribute("data-value",i.value),s.appendChild(r)}),this.show()),u.find("> .tt-suggestions").data({query:t,dataset:e.name}).empty().append(s),this.trigger("suggestionsRender"),this.hideIfEmpty()},clearSuggestions:function(){this.hide(),this.$menu.find(".tt-suggestions").empty()}}),t}(),TypeaheadView=function(){function t(t){utils.bindAll(this),this.$node=e(t.input),this.datasets=t.datasets,utils.each(this.datasets,function(t,e){var i='<li class="tt-suggestion">%body</li>';e.template=e.template?e.engine.compile(i.replace("%body",e.template)):{render:function(t){return i.replace("%body",t.value)}}}),this.inputView=new InputView({input:this.$node.find(".tt-query"),hint:this.$node.find(".tt-hint")}),this.dropdownView=new DropdownView({menu:this.$node.find(".tt-dropdown-menu")}),this.dropdownView.on("select",this._handleSelection).on("cursorOn",this._setInputValueToSuggestionUnderCursor).on("cursorOff",this._setInputValueToQuery).on("cursorOff",this._updateHint).on("suggestionsRender",this._updateHint).on("hide",this._clearHint).on("hide show",this._setPreventDefaultValueForTab),this.inputView.on("blur",this._hideDropdown).on("blur",this._setInputValueToQuery).on("enter",this._handleSelection).on("queryChange whitespaceChange",this._setLanguageDirection).on("whitespaceChange",this._updateHint).on("queryChange",this._clearHint).on("queryChange",this._clearSuggestions).on("focus queryChange",this._getSuggestions).on("esc",this._hideDropdown).on("esc",this._setInputValueToQuery).on("up down",this._moveDropdownCursor).on("tab left right",this._autocomplete)}function e(t){var e=$(t),n=$(i.hint).css({"background-color":e.css("background-color")});if(0===e.length)return null;try{e.attr("dir","auto")}catch(s){}return e.attr({autocomplete:!1,spellcheck:!1}).addClass("tt-query").wrap(i.wrapper).parent().append(n).append(i.dropdown)}var i={wrapper:'<span class="twitter-typeahead"></span>',hint:'<input class="tt-hint" type="text" autocomplete="false" spellcheck="false" disabled>',dropdown:'<ol class="tt-dropdown-menu"></ol>'};return utils.mixin(t.prototype,EventTarget,{_setPreventDefaultValueForTab:function(t){this.inputView.setPreventDefaultValueForKey("9","show"===t.type)},_setLanguageDirection:function(){var t="tt-"+this.inputView.getLanguageDirection();this.$node.hasClass(t)||this.$node.removeClass("tt-ltr tt-rtl").addClass(t)},_updateHint:function(){var t,e,i,n,s=this.dropdownView.getFirstSuggestion(),r=s?s.value:null;r&&(t=this.inputView.getInputValue(),e=t.replace(/\s{2,}/g," ").replace(/^\s+/g,""),i=RegExp("^(?:"+e+")(.*$)","i"),n=i.exec(r),this.inputView.setHintValue(t+(n?n[1]:"")))},_clearHint:function(){this.inputView.setHintValue()},_clearSuggestions:function(){this.dropdownView.clearSuggestions()},_setInputValueToQuery:function(){this.inputView.setInputValue(this.inputView.getQuery())},_setInputValueToSuggestionUnderCursor:function(t){this._clearHint(),this.inputView.setInputValue(t.data.value,!0)},_hideDropdown:function(t){this.dropdownView["blur"===t.type?"hideUnlessMouseIsOverDropdown":"hide"]()},_moveDropdownCursor:function(t){this.dropdownView["up"===t.type?"moveCursorUp":"moveCursorDown"]()},_handleSelection:function(t){var e="select"===t.type,i=e?t.data:this.dropdownView.getSuggestionUnderCursor();i&&(this.inputView.setInputValue(i.value),e?this.inputView.focus():t.data.preventDefault(),this.dropdownView.hide())},_getSuggestions:function(){var t=this,e=this.inputView.getQuery();utils.each(this.datasets,function(i,n){n.getSuggestions(e,function(i){t._renderSuggestions(e,n,i)})})},_renderSuggestions:function(t,e,i){t===this.inputView.getQuery()&&(i=i.slice(0,e.limit),this.dropdownView.renderSuggestions(t,e,i))},_autocomplete:function(t){var e,i,n,s;("right"!==t.type&&"left"!==t.type||(e=this.inputView.isCursorAtEnd(),i="ltr"===this.inputView.getLanguageDirection()?"left"===t.type:"right"===t.type,e&&!i))&&(n=this.inputView.getQuery(),s=this.inputView.getHintValue(),""!==s&&n!==s&&this.inputView.setInputValue(s))}}),t}(),version="%VERSION%";(function(){var t,e,i={},n={};e={initialize:function(e){var s={};if(e=utils.isArray(e)?e:[e],0===e.length)throw Error("no datasets provided");return t=t||new Transport(n),utils.each(e,function(e,n){var r,o=n.name=n.name||utils.getUniqueId();if(i[o])r=i[o];else{if(n.limit=n.limit||5,n.template=n.template,n.engine=n.engine,n.template&&!n.engine)throw Error("no template engine specified for "+o);r=i[o]=new Dataset({name:n.name,limit:n.limit,local:n.local,prefetch:n.prefetch,remote:n.remote,matcher:n.matcher,ranker:n.ranker,transport:t})}s[o]={name:n.name,limit:n.limit,template:n.template,engine:n.engine,getSuggestions:r.getSuggestions}}),this.each(function(){$(this).data({typeahead:new TypeaheadView({input:this,datasets:s})})})}},jQuery.fn.typeahead=function(t){e[t]?e[t].apply(this,[].slice.call(arguments,1)):e.initialize.apply(this,arguments)}})();